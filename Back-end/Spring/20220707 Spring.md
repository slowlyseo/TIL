title : Spring - MyBatis(MySql) DB ì—°ë™

date : 20220707



------



ìŠ¤í”„ë§ê³¼ db ì—°ê²°í•˜ê¸° ... ìì²´ë„ ì‰½ì§€ ì•Šì•˜ì§€ë§Œ ì´ê±´ ë…¸íŠ¸ ì°¸ê³ í•˜ë©´ ë¨.

ë¬¸ì œëŠ” ì—°ë™ëœ dbì˜ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ì™€ì„œ springì—ì„œ ì‘ì—…í•˜ëŠ” ê²ƒì´ë‹¤...



(mySqlì— ìƒˆ ìŠ¤í‚¤ë§ˆ, í…Œì´ë¸” ìƒì„± - product)



"product" ë°ì´í„°ë¥¼ ê°€ì§€ê³  Springì—ì„œ ì „ì²´ ìƒí’ˆ ì¡°íšŒ ì²˜ë¦¬ë¥¼ í•  ê²ƒ.

í° íë¦„ì€ ì´ë ‡ë‹¤! â†“



#### dbì—°ë™-spring ì‘ì—… ì²˜ë¦¬ ê³¼ì •

1. Controllerì˜ ìš”ì²­
2. Service í´ë˜ìŠ¤ì˜ listAllProduct() ë©”ì†Œë“œ í˜¸ì¶œ
3. IProduct DAOì˜ listAllProduct() ë©”ì†Œë“œ í˜¸ì¶œ
4. Mapperì—ì„œ SQL ì²˜ë¦¬ í›„ ë°˜í™˜
5. Serviceì—ì„œ ë°›ì€ í›„
6. Controllerì— ë°˜í™˜
7. View í˜ì´ì§€ë¡œ ì „ë‹¬
8. í™”ë©´ì— ê²°ê³¼ ì¶œë ¥



------



ì½”ë“œë¡œ ì‚´í´ë³´ë©´...



```
// DI ì„¤ì •
	@Autowired
	ProductService prdService;

	// ì‹œì‘ ì‹œ index í˜ì´ì§€ ì—´ê¸°
	@RequestMapping("/")
	public String index() {
		return "index";
	}

	// ì „ì²´ ìƒí’ˆ ì¡°íšŒ ìš”ì²­ ì²˜ë¦¬
	@RequestMapping("/product/productAllList")
	public String viewProductAllList(Model model) {

		// ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œ í˜¸ì¶œí•´ì„œ ê²°ê³¼ ë°›ì•„ì˜´
		ArrayList<ProductVO> prdList = prdService.listAllProduct();

		// ëª¨ë¸ ì„¤ì •
		model.addAttribute("prdList", prdList);

		return "product/productAllListView"; // product í´ë”ì˜ productAllListView.jsp
	}
```



`@RequestMapping("/product/productAllList")`

- RquestMapping ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬, ì‚¬ìš©ìë¡œë¶€í„° ìš”ì²­ ì²˜ë¦¬ê°€ ë“¤ì–´ì˜¤ë©´ productAllList í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.



`public String viewProductAllList(Model model)`

- ë¦¬ìŠ¤íŠ¸ë¥¼ Model ê°ì²´ë¥¼ ì‚¬ìš©í•´ ë°›ì•„ì˜¨ë‹¤ê³  ì„ ì–¸. â† (?) í™•ì‹¤ì¹˜ ì•ŠìŒ ...



`ArrayList<ProductVO> prdList = prdService.listAllProduct();`

- Productì˜ ArrayListë¥¼ prdListë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥í•œë‹¤.
- ì´ ë•Œ Service ê°ì²´ë¥¼ ì‚¬ìš©í•œë‹¤. â† (?) í™•ì‹¤ì¹˜ ì•ŠìŒ ...



`model.addAttribute("prdList", prdList);`

- ì €ì¥í•œ ë³€ìˆ˜ë¥¼ modelë¡œ ë°›ì•„ì˜¨ë‹¤.



`return "product/productAllListView";`

- ìœ„ì—ì„œ ì²˜ë¦¬í•œ ëª¨ë“  ê²ƒë“¤ì„ productAllListView í˜ì´ì§€ì— ì¶œë ¥í•œë‹¤.



------



ëŒ€ì¶© ì´ëŸ° íë¦„(?)ì¸ ê²ƒ ê°™ë‹¤... ì§„ë„ë¥¼ ë„ˆë¬´ ë¹¨ë¦¬ ë‚˜ê°€ê³ , ì´í•´í•˜ì§€ ëª»í•œ ìƒíƒœë¡œ ë°›ì•„ ì“°ê¸°ë§Œ í•´ì„œ ì •í™•í•˜ì§„ ì•Šë‹¤. ğŸ˜‚



íŒ¨í‚¤ì§€ë“¤ì„ ì‚´í´ë³´ë©´ ...



```
	// ìƒí’ˆ ë“±ë¡ í¼ ì—´ê¸° ìš”ì²­ ì²˜ë¦¬
	@RequestMapping("/product/productNewForm")
	public String viewProductNewForm() {
		return "product/productNewForm";
	}

	// ìƒí’ˆ ë“±ë¡ : ìƒí’ˆ ì •ë³´ DB ì €ì¥
	@RequestMapping("/product/insertProduct")
	public String insertProduct(ProductVO prd) {
		prdService.insertProduct(prd);

		// DBì— ë°ì´í„° ì €ì¥í•œ í›„ ì „ì²´ ìƒí’ˆ ì¡°íšŒ í™”ë©´ìœ¼ë¡œ í¬ì›Œë”©
		return "redirect:./productAllList";
	}

	// ìƒí’ˆ ìƒì„¸ ì •ë³´ ì¡°íšŒ : 1ê°œ ìƒí’ˆ ì¡°íšŒ
	@RequestMapping("/product/productDetailView/{prdNo}")
	public String detailViewProduct(@PathVariable String prdNo, Model model) {
		ProductVO prd = prdService.detailViewProduct(prdNo);
		model.addAttribute("prd", prd);
		return "product/productDetailView";
	}

	// ìƒí’ˆ ì •ë³´ ìˆ˜ì • í¼ ìš”ì²­ ì²˜ë¦¬
	@RequestMapping("/product/productUpdateForm/{prdNo}")
	public String updateProductForm(@PathVariable String prdNo, Model model) {
		// ìˆ˜ì •í•  ìƒí’ˆë²ˆí˜¸ ë°›ì•„ì„œ detailViewProduct() í˜¸ì´ í›„ ì „ë‹¬, í•´ë‹¹ ìƒí’ˆ ì •ë³´ (1ê°œ) ë°›ì•„ì„œ ëª¨ë¸ ì„¤ì •
		ProductVO prd = prdService.detailViewProduct(prdNo);
		model.addAttribute("prd", prd);
		return "product/productUpdateForm";
	}

	// ìˆ˜ì • ë‚´ìš© DB ì €ì¥
	@RequestMapping("/product/updateProduct")
	public String updateProduct(ProductVO prd) {
		prdService.updateProduct(prd);

		// DBì— ìˆ˜ì •ëœ ë°ì´í„° ì €ì¥ í›„ ì „ì²´ ë¦¬ìŠ¤íŠ¸ë¡œ í¬ì›Œë”©
		return "redirect:./productAllList";
	}
	
	// ìƒí’ˆ ì •ë³´ ì‚­ì œ
	@RequestMapping("/product/deleteProduct/{prdNo}")
	public String deleteProduct(@PathVariable String prdNo) {
		prdService.deleteProduct(prdNo);
		
		return "redirect:/product/productAllList";
	}
```

- ëŒ€ì¶© ì´ëŸ° ì‹ìœ¼ë¡œ ì‚¬ìš©ìë¡œë¶€í„° ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” ê²Œ Controllerì˜ ì—­í• ì´ë¼ê³  ë³´ë©´ ëœë‹¤.



```
package com.spring_mvc.mybatis.dao;

import java.util.ArrayList;

import com.spring_mvc.mybatis.model.ProductVO;

public interface IProductDAO {
	public ArrayList<ProductVO> listAllProduct(); // ì „ì²´ ìƒí’ˆ ì •ë³´ ì¡°íšŒ

	public void insertProduct(ProductVO prd); // ìƒí’ˆ ì •ë³´ ë“±ë¡

	public void updateProduct(ProductVO prd); // ìƒí’ˆ ì •ë³´ ìˆ˜ì •

	public void deleteProduct(String prdNo); // ìƒí’ˆ ì •ë³´ ì‚­ì œ

	public ProductVO detailViewProduct(String prdNo); // ìƒì„¸ ìƒí’ˆ ì •ë³´ ì¡°íšŒ (1ê°œì˜ ìƒí’ˆë§Œ ì¡°íšŒ)
}
```

- ì´ê±´ DAO ì¸í„°í˜ì´ìŠ¤ ...



```
<mapper namespace="com.spring_mvc.mybatis.dao.IProductDAO">
	<resultMap id="prdResult"
		type="com.spring_mvc.mybatis.model.ProductVO">
		<result property="prdNo" column="prdNo" />
		<result property="prdName" column="prdName" />
		<result property="prdPrice" column="prdPrice" />
		<result property="prdCompany" column="prdCompany" />
		<result property="prdStock" column="prdStock" />
	</resultMap>

	<!-- ì „ì²´ ìƒí’ˆ ì¡°íšŒ -->
	<!-- ì£¼ì˜! idëŠ” IProductDAOì˜ listAllProduct() ë©”ì†Œë“œ ì´ë¦„ê³¼ ë™ì¼í•´ì•¼ í•¨ -->
	<select id="listAllProduct" resultMap="prdResult">
		SELECT * FROM product
		ORDER BY prdNo
	</select>

	<!-- ìƒí’ˆ ë“±ë¡ -->
	<insert id="insertProduct"
		parameterType="com.spring_mvc.mybatis.model.ProductVO">
		INSERT INTO product (prdNo, prdName, prdPrice,
		prdCompany, prdStock)
		VALUES(#{prdNo}, #{prdName}, #{prdPrice},
		#{prdCompany}, #{prdStock} )
	</insert>

	<!-- ìƒí’ˆ ìƒì„¸ ì •ë³´ ì¡°íšŒ -->
	<select id="detailViewProduct" parameterType="String"
		resultType="com.spring_mvc.mybatis.model.ProductVO">

		SELECT * FROM product WHERE prdNo=#{prdNo}

	</select>

	<!-- ìƒí’ˆ ì •ë³´ ìˆ˜ì • -->
	<update id="updateProduct"
		parameterType="com.spring_mvc.mybatis.model.ProductVO">
		UPDATE product
		SET prdName=#{prdName},
		prdPrice=#{prdPrice},
		prdCompany=#{prdCompany}, prdStock=#{prdStock}
		WHERE prdNo=#{prdNo}

	</update>

	<!-- ìƒí’ˆ ì •ë³´ ì‚­ì œ -->
	<delete id="deleteProduct" parameterType="String">
		DELETE FROM product WHERE prdNo=#{prdNo}

	</delete>

</mapper>
```

- ë§¤í¼ëŠ” MySQLì—ì„œ ì´ë£¨ì–´ì§€ëŠ” ì¼ë“¤ì„ ëŒ€ì‹  ìˆ˜í–‰í•´ì£¼ëŠ” jsp íŒŒì¼ì´ë‹¤!

- ì½”ë“œì—ì„œ ë³´ë‹¤ì‹œí”¼ selectë¬¸ê³¼ deleteë¬¸ ë“±ì„ ìˆ˜í–‰í•´ì¤€ë‹¤.

- ì…ë ¥ë°›ì€ ì •ë³´ë¥¼ dbì— ì €ì¥í•˜ê±°ë‚˜, ì‚­ì œí•˜ê±°ë‚˜, ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.



```
package com.spring_mvc.mybatis.model;

public class ProductVO {
	private String prdNo;
	private String prdName;
	private int prdPrice;
	private String prdCompany;
	private int prdStock;
	
	public String getPrdNo() {
		return prdNo;
	}
	public void setPrdNo(String prdNo) {
		this.prdNo = prdNo;
	}
	public String getPrdName() {
		return prdName;
	}
	public void setPrdName(String prdName) {
		this.prdName = prdName;
	}
	public int getPrdPrice() {
		return prdPrice;
	}
	public void setPrdPrice(int prdPrice) {
		this.prdPrice = prdPrice;
	}
	public String getPrdCompany() {
		return prdCompany;
	}
	public void setPrdCompany(String prdCompany) {
		this.prdCompany = prdCompany;
	}
	public int getPrdStock() {
		return prdStock;
	}
	public void setPrdStock(int prdStock) {
		this.prdStock = prdStock;
	}
	
}
```

- ìµìˆ™í•œ ëª¨ì–‘ìƒˆ getter&setterë¥¼ ì‚¬ìš©í•´ ë³€ìˆ˜ì— ì œí’ˆ ì •ë³´ë“¤ì„ ì €ì¥í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” mybatis.model íŒ¨í‚¤ì§€ ì† ProductVo í´ë˜ìŠ¤ íŒŒì¼ì´ë‹¤.



```
package com.spring_mvc.mybatis.service;

import java.util.ArrayList;

import com.spring_mvc.mybatis.model.ProductVO;

public interface IProductService {
	public ArrayList<ProductVO> listAllProduct(); // ì „ì²´ ìƒí’ˆ ì •ë³´ ì¡°íšŒ
	public void insertProduct(ProductVO prd); // ìƒí’ˆ ì •ë³´ ë“±ë¡
	public void updateProduct(ProductVO prd); // ìƒí’ˆ ì •ë³´ ìˆ˜ì •
	public void deleteProduct(String prdNo);// ìƒí’ˆ ì •ë³´ ì‚­ì œ
	public ProductVO detailViewProduct(String prdNo); // ìƒì„¸ ìƒí’ˆ ì •ë³´ ì¡°íšŒ (1ê°œì˜ ìƒí’ˆë§Œ ì¡°íšŒ)
}
```

- ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤
- insert, update, delete, detailView ë“± ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ìƒì„±í•´ë‘ 



```
package com.spring_mvc.mybatis.service;

import java.util.ArrayList;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Service;

import com.spring_mvc.mybatis.dao.IProductDAO;
import com.spring_mvc.mybatis.model.ProductVO;

@Service
public class ProductService implements IProductService {
	
	// myBatis ì‚¬ìš©í•˜ëŠ” ê²½ìš°
	@Autowired
	@Qualifier("IProductDAO")
	IProductDAO dao;
	
	@Override
	public ArrayList<ProductVO> listAllProduct() {
		return dao.listAllProduct();
	}

	@Override
	public void insertProduct(ProductVO prd) {
		dao.insertProduct(prd);
	}

	@Override
	public void updateProduct(ProductVO prd) {
		dao.updateProduct(prd);
	}

	@Override
	public void deleteProduct(String prdNo) {
		dao.deleteProduct(prdNo);
	}

	@Override
	public ProductVO detailViewProduct(String prdNo) {
		return dao.detailViewProduct(prdNo);
	}

}
```

- ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ë§¤í¼ì—ì„œ ì²˜ë¦¬í•œ ê²ƒì„ ì„œë¹„ìŠ¤ê°€ ë°›ì•„ì„œ ë·° í˜ì´ì§€ë¡œ ë°˜í™˜í•´ì¤€ë‹¤. (ì‚¬ì‹¤ ì´ ë¶€ë¶„ ì´í•´ ëª»í•¨ ...)



	// myBatis ì‚¬ìš©í•˜ëŠ” ê²½ìš°
	@Autowired
	@Qualifier("IProductDAO")

- ì´ë ‡ê²Œ myBatisëŠ” ë”°ë¡œ ì²˜ë¦¬í•´ì¤˜ì•¼ í•¨
- Autowired ì–´ë…¸í…Œì´ì…˜ê³¼ Qualifier ì–´ë…¸í…Œì´ì…˜ ë™ì‹œì— ì‚¬ìš©



------



ëŒ€ì¶© ì´ë ‡ê²Œ ì²˜ë¦¬ëœ ê²ƒë“¤ì„ src/main/../../ views/product í´ë” ì† View í˜ì´ì§€ì™€ Form í˜ì´ì§€ì—ì„œ ì¶œë ¥í•´ ë³´ì—¬ì£¼ëŠ” ê²ƒ

-> ë” í™•ì‹¤í•œ ê°œë…ì€ ë”°ë¡œ ê³µë¶€í•˜ê¸°

ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸